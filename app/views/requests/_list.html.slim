table.table.table-striped.table-hover
  thead
    tr
      th Id
      th Title
      th = t Request.human_attribute_name(:user)
      th 申請フロー
      th = t Request.human_attribute_name(:status)
      th Action

  tbody
    - @requests.each do |request|
      tr
        td = request.id
        td = request.title
        td = request.user.name
        td = request.flow.try(:name)
        td = request.status_message
        td 
          = link_to '詳細', request, class: 'btn btn-default'
          '
          = link_to 'log', audit_request_path(request), class: 'btn btn-default'
          '
          - if RequestFlowPolicy.new(request: request).withdrawable?(current_user)
            '
            = link_to '申請を取り消す', withdraw_request_path(request), data: { confirm: '申請を取り消すと今までの承認がリセットされますがよろしいですか?' }, method: :put, class: 'btn btn-danger'
            '
          - if request.status == 'executed'
            = link_to '作業完了報告', report_request_path(request), class: 'btn btn-default'
          - if request.status == 'wait_for_execution'
            = link_to '購入/実行完了報告', execution_report_request_path(request), class: 'btn btn-default'

          - if RequestFlowPolicy.new(request: request).editable?(current_user)
            = link_to '編集', edit_request_path(request), class: 'btn btn-default'
          - if RequestFlowPolicy.new(request: request).submitable?(current_user)
            = link_to '提出', submit_request_path(request), class: 'btn btn-default', method: :put
          - if RequestFlowPolicy.new(request: request).flow_editable?(current_user)
            = link_to '申請フローを選択する', define_flow_request_path(request), class: 'btn btn-default'
          - if RequestFlowPolicy.new(request: request).deletable?(current_user)
            = link_to t('actions.destroy'), request, data: { confirm: '削除してもよろしいですか?' }, method: :delete, class: 'btn btn-default'

